# 2Org1Peer Ansible Playbook

An Ansible playbook for building a Hyperledger Fabric network with two organizations, Org1 and Org2, each with one peer. The peers are configured with a single channel, channel1. The fixed-asset contract is instantiated on this channel, with an endorsement policy stating that both organizations must endorse any transactions. The channel is also instantiated with a private data configuration file.

## Pre-requisites
Before you can run this Ansible playbook, you need to make sure that you have all of the pre-requisites installed. 

1. You first need to install the Ansible role which is provided as part of the IBM Blockchain Platform and enables you to automate the building of Hyperledger Fabric networks. To do this use the following command in your terminal:
```
ansible-galaxy install ibm.blockchain_platform_manager
```

2. The Ansible role requires the following pre-requisites:
    - Python 3.7+
        - https://www.python.org/downloads/
    - Ansible 2.8+
        - `pip install ansible`
    - Hyperledger Fabric v1.4 binaries (`configtxgen`, `peer`, `fabric-ca-client`, etc)
        - https://hyperledger-fabric.readthedocs.io/en/release-1.4/install.html
    - One of the following supported deployment targets:
        - IBM Blockchain Platform on IBM Cloud
        - IBM Blockchain Platform on Red Hat OpenShift
        - Docker 19.03+
    - Docker SDK for Python (if using Docker)
        - `pip install docker`
    - `jq`
        - https://stedolan.github.io/jq/download/
    - `sponge`
        - `apt-get install moreutils` (Ubuntu)
        - `brew install moreutils` (macOS)


3. From this directory in your terminal, run the following command to install all required roles, including the `ibm.blockchain_platform_manager` role, from Ansible Galaxy:
    ```
    ansible-galaxy install -r requirements.yml --force
    ```

## Run the Ansible playbook
To run the ansible playbook, use the following command from this playbook directory
```
ansible-playbook playbook.yml
```

To teardown the Ansible generated Fabric network and remove all associated files, use the following command
```
ansible-playbook --extra-vars state=absent playbook.yml
```

## Next steps
To use this network for a benchmark run, you'll also need to set up a network configuration file based on this Ansible generated Fabric network.

Below is a list of some of the things that will need to be included in the network configuration file and where you can obtain them from the playbook.yml and from the files generated by the playbook.

| Property | Where to find it |
|---|---|
| url | This will be in the format of `grpcs://localhost:port`. You can find the port number in the playbook.yml file under `docker: port` |
| hostnameOverride | You can find the port number in the playbook.yml file under `docker: hostname` |
| mspid | You can find this in the playbook.yml file under `msp: id` |
| tlsCACerts | The tlsCACerts is in one of the files generated by the playbook. The path to the file for Org1 should be `networks/fabric/ansible-playbooks/2org1peer/wallets/Org1/ca-tls-root.pem` |

You can find more information on setting up a Fabric network configuration file and the other properties you will need to include on the [Hyperledger Caliper](https://hyperledger.github.io/caliper/v0.3.1/fabric-config/) website.
